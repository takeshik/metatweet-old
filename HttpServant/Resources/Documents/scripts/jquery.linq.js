/*--------------------------------------------------------------------------
* jquery.linq.js - LINQ for jQuery
* ver 2.1.0.0 (May. 18th, 2010)
*
* created and maintained by neuecc <ils@neue.cc>
* licensed under Microsoft Public License(Ms-PL)
* http://neue.cc/
* http://linqjs.codeplex.com/
*--------------------------------------------------------------------------*/
jQuery.extend({Enumerable:function(){var l="Single:sequence contains more than one element.",d=true,b=null,a=false,e=function(a){this.GetEnumerator=a};e.Choice=function(){var a=arguments[0]instanceof Array?arguments[0]:arguments;return new e(function(){return new f(g.Blank,function(){return this.Yield(a[Math.floor(Math.random()*a.length)])},g.Blank)})};e.Cycle=function(){var a=arguments[0]instanceof Array?arguments[0]:arguments;return new e(function(){var b=0;return new f(g.Blank,function(){if(b>=a.length)b=0;return this.Yield(a[b++])},g.Blank)})};e.Empty=function(){return new e(function(){return new f(g.Blank,function(){return a},g.Blank)})};e.From=function(i){if(i==b)return e.Empty();if(i instanceof e)return i;if(typeof i==h.Number||typeof i==h.Boolean)return e.Repeat(i,1);if(typeof i==h.String)return new e(function(){var b=0;return new f(g.Blank,function(){return b<i.length?this.Yield(i.charAt(b++)):a},g.Blank)});if(typeof i!=h.Function){if(typeof i.length==h.Number)return new e(function(){var b=0;return new f(g.Blank,function(){while(b<i.length){if(!(i[b]instanceof Function))return this.Yield(i[b++]);b++}return a},g.Blank)});if(!(i instanceof Object)&&c.IsIEnumerable(i))return new e(function(){var c=d,b;return new f(function(){b=new Enumerator(i)},function(){if(c)c=a;else b.moveNext();return b.atEnd()?a:this.Yield(b.item())},g.Blank)})}return new e(function(){var b=[],c=0;return new f(function(){for(var a in i)!(i[a]instanceof Function)&&b.push({Key:a,Value:i[a]})},function(){return c<b.length?this.Yield(b[c++]):a},g.Blank)})},e.Return=function(a){return e.Repeat(a,1)};e.Matches=function(h,d,c){if(c==b)c="";if(d instanceof RegExp){c+=d.ignoreCase?"i":"";c+=d.multiline?"m":"";d=d.source}if(c.indexOf("g")===-1)c+="g";return new e(function(){var b;return new f(function(){b=new RegExp(d,c)},function(){var c=b.exec(h);return c?this.Yield(c):a},g.Blank)})};e.Range=function(d,c,a){if(a==b)a=1;return e.ToInfinity(d,a).Take(c)};e.RangeDown=function(d,c,a){if(a==b)a=1;return e.ToNegativeInfinity(d,a).Take(c)};e.RangeTo=function(c,d,a){if(a==b)a=1;return c<d?e.ToInfinity(c,a).TakeWhile(function(a){return a<=d}):e.ToNegativeInfinity(c,a).TakeWhile(function(a){return a>=d})};e.Repeat=function(c,a){if(a!=b)return e.Repeat(c).Take(a);return new e(function(){return new f(g.Blank,function(){return this.Yield(c)},g.Blank)})};e.RepeatWithFinalize=function(a,d){a=c.CreateLambda(a);d=c.CreateLambda(d);return new e(function(){var c;return new f(function(){c=a()},function(){return this.Yield(c)},function(){if(c!=b){d(c);c=b}})})};e.Generate=function(a,d){if(d!=b)return e.Generate(a).Take(d);a=c.CreateLambda(a);return new e(function(){return new f(g.Blank,function(){return this.Yield(a())},g.Blank)})};e.ToInfinity=function(c,a){if(c==b)c=0;if(a==b)a=1;return new e(function(){var b;return new f(function(){b=c-a},function(){return this.Yield(b+=a)},g.Blank)})};e.ToNegativeInfinity=function(c,a){if(c==b)c=0;if(a==b)a=1;return new e(function(){var b;return new f(function(){b=c+a},function(){return this.Yield(b-=a)},g.Blank)})};e.Unfold=function(h,b){b=c.CreateLambda(b);return new e(function(){var e=d,c;return new f(g.Blank,function(){if(e){e=a;c=h;return this.Yield(c)}c=b(c);return this.Yield(c)},g.Blank)})};e.prototype={CascadeBreadthFirst:function(g,b){var h=this;g=c.CreateLambda(g);b=c.CreateLambda(b);return new e(function(){var i,k=0,j=[];return new f(function(){i=h.GetEnumerator()},function(){while(d){if(i.MoveNext()){j.push(i.Current());return this.Yield(b(i.Current(),k))}var f=e.From(j).SelectMany(function(a){return g(a)});if(!f.Any())return a;else{k++;j=[];c.Dispose(i);i=f.GetEnumerator()}}},function(){c.Dispose(i)})})},CascadeDepthFirst:function(g,b){var h=this;g=c.CreateLambda(g);b=c.CreateLambda(b);return new e(function(){var j=[],i;return new f(function(){i=h.GetEnumerator()},function(){while(d){if(i.MoveNext()){var f=b(i.Current(),j.length);j.push(i);i=e.From(g(i.Current())).GetEnumerator();return this.Yield(f)}if(j.length<=0)return a;c.Dispose(i);i=j.pop()}},function(){try{c.Dispose(i)}finally{e.From(j).ForEach(function(a){a.Dispose()})}})})},Flatten:function(){var h=this;return new e(function(){var j,i=b;return new f(function(){j=h.GetEnumerator()},function(){while(d){if(i!=b)if(i.MoveNext())return this.Yield(i.Current());else i=b;if(j.MoveNext())if(j.Current()instanceof Array){c.Dispose(i);i=e.From(j.Current()).SelectMany(g.Identity).Flatten().GetEnumerator();continue}else return this.Yield(j.Current());return a}},function(){try{c.Dispose(j)}finally{c.Dispose(i)}})})},Pairwise:function(b){var d=this;b=c.CreateLambda(b);return new e(function(){var e;return new f(function(){e=d.GetEnumerator();e.MoveNext()},function(){var c=e.Current();return e.MoveNext()?this.Yield(b(c,e.Current())):a},function(){c.Dispose(e)})})},Scan:function(i,g,j){if(j!=b)return this.Scan(i,g).Select(j);var h;if(g==b){g=c.CreateLambda(i);h=a}else{g=c.CreateLambda(g);h=d}var k=this;return new e(function(){var b,e,j=d;return new f(function(){b=k.GetEnumerator()},function(){if(j){j=a;if(!h){if(b.MoveNext())return this.Yield(e=b.Current())}else return this.Yield(e=i)}return b.MoveNext()?this.Yield(e=g(e,b.Current())):a},function(){c.Dispose(b)})})},Select:function(b){var d=this;b=c.CreateLambda(b);return new e(function(){var e,g=0;return new f(function(){e=d.GetEnumerator()},function(){return e.MoveNext()?this.Yield(b(e.Current(),g++)):a},function(){c.Dispose(e)})})},SelectMany:function(g,d){var h=this;g=c.CreateLambda(g);if(d==b)d=function(b,a){return a};d=c.CreateLambda(d);return new e(function(){var j,i=undefined,k=0;return new f(function(){j=h.GetEnumerator()},function(){if(i===undefined)if(!j.MoveNext())return a;do{if(i==b){var f=g(j.Current(),k++);i=e.From(f).GetEnumerator()}if(i.MoveNext())return this.Yield(d(j.Current(),i.Current()));c.Dispose(i);i=b}while(j.MoveNext());return a},function(){try{c.Dispose(j)}finally{c.Dispose(i)}})})},Where:function(b){b=c.CreateLambda(b);var d=this;return new e(function(){var e,g=0;return new f(function(){e=d.GetEnumerator()},function(){while(e.MoveNext())if(b(e.Current(),g++))return this.Yield(e.Current());return a},function(){c.Dispose(e)})})},OfType:function(c){var a;switch(c){case Number:a=h.Number;break;case String:a=h.String;break;case Boolean:a=h.Boolean;break;case Function:a=h.Function;break;default:a=b}return a===b?this.Where(function(a){return a instanceof c}):this.Where(function(b){return typeof b===a})},Zip:function(d,b){b=c.CreateLambda(b);var g=this;return new e(function(){var i,h,j=0;return new f(function(){i=g.GetEnumerator();h=e.From(d).GetEnumerator()},function(){if(i.MoveNext()&&h.MoveNext())return this.Yield(b(i.Current(),h.Current(),j++));return a},function(){try{c.Dispose(i)}finally{c.Dispose(h)}})})},Join:function(m,i,h,k,j){i=c.CreateLambda(i);h=c.CreateLambda(h);k=c.CreateLambda(k);j=c.CreateLambda(j);var l=this;return new e(function(){var n,q,o=b,p=0;return new f(function(){n=l.GetEnumerator();q=e.From(m).ToLookup(h,g.Identity,j)},function(){while(d){if(o!=b){var c=o[p++];if(c!==undefined){isInnerOut=a;return this.Yield(k(n.Current(),c))}c=b;p=0}if(n.MoveNext()){var e=i(n.Current());o=q.Get(e).ToArray()}else return a}},function(){c.Dispose(n)})})},GroupJoin:function(l,h,d,j,i){h=c.CreateLambda(h);d=c.CreateLambda(d);j=c.CreateLambda(j);i=c.CreateLambda(i);var k=this;return new e(function(){var m=k.GetEnumerator(),n=b;return new f(function(){m=k.GetEnumerator();n=e.From(l).ToLookup(d,g.Identity,i)},function(){if(m.MoveNext()){var b=n.Get(h(m.Current()));return this.Yield(j(m.Current(),b))}return a},function(){c.Dispose(m)})})},All:function(b){b=c.CreateLambda(b);var e=d;this.ForEach(function(c){if(!b(c)){e=a;return a}});return e},Any:function(e){e=c.CreateLambda(e);var b=this.GetEnumerator();try{if(arguments.length==0)return b.MoveNext();while(b.MoveNext())if(e(b.Current()))return d;return a}finally{c.Dispose(b)}},Concat:function(d){var g=this;return new e(function(){var i,h;return new f(function(){i=g.GetEnumerator()},function(){if(h==b){if(i.MoveNext())return this.Yield(i.Current());h=e.From(d).GetEnumerator()}if(h.MoveNext())return this.Yield(h.Current());return a},function(){try{c.Dispose(i)}finally{c.Dispose(h)}})})},Insert:function(h,b){var g=this;return new e(function(){var j,i,l=0,k=a;return new f(function(){j=g.GetEnumerator();i=e.From(b).GetEnumerator()},function(){if(l==h&&i.MoveNext()){k=d;return this.Yield(i.Current())}if(j.MoveNext()){l++;return this.Yield(j.Current())}if(!k&&i.MoveNext())return this.Yield(i.Current());return a},function(){try{c.Dispose(j)}finally{c.Dispose(i)}})})},Alternate:function(a){a=e.Return(a);return this.SelectMany(function(b){return e.Return(b).Concat(a)}).TakeExceptLast()},Contains:function(f,b){b=c.CreateLambda(b);var e=this.GetEnumerator();try{while(e.MoveNext())if(b(e.Current())===f)return d;return a}finally{c.Dispose(e)}},DefaultIfEmpty:function(b){var g=this;return new e(function(){var e,h=d;return new f(function(){e=g.GetEnumerator()},function(){if(e.MoveNext()){h=a;return this.Yield(e.Current())}else if(h){h=a;return this.Yield(b)}return a},function(){c.Dispose(e)})})},Distinct:function(a){return this.Except(e.Empty(),a)},Except:function(d,b){b=c.CreateLambda(b);var g=this;return new e(function(){var h,i;return new f(function(){h=g.GetEnumerator();i=new m(b);e.From(d).ForEach(function(a){i.Add(a)})},function(){while(h.MoveNext()){var b=h.Current();if(!i.Contains(b)){i.Add(b);return this.Yield(b)}}return a},function(){c.Dispose(h)})})},Intersect:function(d,b){b=c.CreateLambda(b);var g=this;return new e(function(){var h,i,j;return new f(function(){h=g.GetEnumerator();i=new m(b);e.From(d).ForEach(function(a){i.Add(a)});j=new m(b)},function(){while(h.MoveNext()){var b=h.Current();if(!j.Contains(b)&&i.Contains(b)){j.Add(b);return this.Yield(b)}}return a},function(){c.Dispose(h)})})},SequenceEqual:function(h,f){f=c.CreateLambda(f);var g=this.GetEnumerator();try{var b=e.From(h).GetEnumerator();try{while(g.MoveNext())if(!b.MoveNext()||f(g.Current())!==f(b.Current()))return a;if(b.MoveNext())return a;return d}finally{c.Dispose(b)}}finally{c.Dispose(g)}},Union:function(d,b){b=c.CreateLambda(b);var g=this;return new e(function(){var j,h,i;return new f(function(){j=g.GetEnumerator();i=new m(b)},function(){var b;if(h===undefined){while(j.MoveNext()){b=j.Current();if(!i.Contains(b)){i.Add(b);return this.Yield(b)}}h=e.From(d).GetEnumerator()}while(h.MoveNext()){b=h.Current();if(!i.Contains(b)){i.Add(b);return this.Yield(b)}}return a},function(){try{c.Dispose(j)}finally{c.Dispose(h)}})})},OrderBy:function(b){return new i(this,b,a)},OrderByDescending:function(a){return new i(this,a,d)},Reverse:function(){var b=this;return new e(function(){var c,d;return new f(function(){c=b.ToArray();d=c.length},function(){return d>0?this.Yield(c[--d]):a},g.Blank)})},Shuffle:function(){var b=this;return new e(function(){var c;return new f(function(){c=b.ToArray()},function(){if(c.length>0){var b=Math.floor(Math.random()*c.length);return this.Yield(c.splice(b,1)[0])}return a},g.Blank)})},GroupBy:function(i,h,d,g){var j=this;i=c.CreateLambda(i);h=c.CreateLambda(h);if(d!=b)d=c.CreateLambda(d);g=c.CreateLambda(g);return new e(function(){var e;return new f(function(){e=j.ToLookup(i,h,g).ToEnumerable().GetEnumerator()},function(){while(e.MoveNext())return d==b?this.Yield(e.Current()):this.Yield(d(e.Current().Key(),e.Current()));return a},function(){c.Dispose(e)})})},PartitionBy:function(j,i,g,h){var l=this;j=c.CreateLambda(j);i=c.CreateLambda(i);h=c.CreateLambda(h);var k;if(g==b){k=a;g=function(b,a){return new n(b,a)}}else{k=d;g=c.CreateLambda(g)}return new e(function(){var b,n,o,m=[];return new f(function(){b=l.GetEnumerator();if(b.MoveNext()){n=j(b.Current());o=h(n);m.push(i(b.Current()))}},function(){var c;while((c=b.MoveNext())==d)if(o===h(j(b.Current())))m.push(i(b.Current()));else break;if(m.length>0){var f=k?g(n,e.From(m)):g(n,m);if(c){n=j(b.Current());o=h(n);m=[i(b.Current())]}else m=[];return this.Yield(f)}return a},function(){c.Dispose(b)})})},BufferWithCount:function(d){var b=this;return new e(function(){var e;return new f(function(){e=b.GetEnumerator()},function(){var b=[],c=0;while(e.MoveNext()){b.push(e.Current());if(++c>=d)return this.Yield(b)}if(b.length>0)return this.Yield(b);return a},function(){c.Dispose(e)})})},Aggregate:function(c,b,a){return this.Scan(c,b,a).Last()},Average:function(a){a=c.CreateLambda(a);var d=0,b=0;this.ForEach(function(c){d+=a(c);++b});return d/b},Count:function(a){a=a==b?g.True:c.CreateLambda(a);var d=0;this.ForEach(function(c,b){if(a(c,b))++d});return d},Max:function(a){if(a==b)a=g.Identity;return this.Select(a).Aggregate(function(a,b){return a>b?a:b})},Min:function(a){if(a==b)a=g.Identity;return this.Select(a).Aggregate(function(a,b){return a<b?a:b})},MaxBy:function(a){a=c.CreateLambda(a);return this.Aggregate(function(b,c){return a(b)>a(c)?b:c})},MinBy:function(a){a=c.CreateLambda(a);return this.Aggregate(function(b,c){return a(b)<a(c)?b:c})},Sum:function(a){if(a==b)a=g.Identity;return this.Select(a).Aggregate(function(a,b){return a+b})},ElementAt:function(e){var c,b=a;this.ForEach(function(g,f){if(f==e){c=g;b=d;return a}});if(!b)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return c},ElementAtOrDefault:function(f,e){var c,b=a;this.ForEach(function(g,e){if(e==f){c=g;b=d;return a}});return !b?e:c},First:function(c){if(c!=b)return this.Where(c).First();var f,e=a;this.ForEach(function(b){f=b;e=d;return a});if(!e)throw new Error("First:No element satisfies the condition.");return f},FirstOrDefault:function(c,e){if(e!=b)return this.Where(e).FirstOrDefault(c);var g,f=a;this.ForEach(function(b){g=b;f=d;return a});return !f?c:g},Last:function(c){if(c!=b)return this.Where(c).Last();var f,e=a;this.ForEach(function(a){e=d;f=a});if(!e)throw new Error("Last:No element satisfies the condition.");return f},LastOrDefault:function(c,e){if(e!=b)return this.Where(e).LastOrDefault(c);var g,f=a;this.ForEach(function(a){f=d;g=a});return !f?c:g},Single:function(e){if(e!=b)return this.Where(e).Single();var f,c=a;this.ForEach(function(a){if(!c){c=d;f=a}else throw new Error(l)});if(!c)throw new Error("Single:No element satisfies the condition.");return f},SingleOrDefault:function(e,f){if(f!=b)return this.Where(f).SingleOrDefault(e);var g,c=a;this.ForEach(function(a){if(!c){c=d;g=a}else throw new Error(l)});return !c?e:g},Skip:function(d){var b=this;return new e(function(){var e,g=0;return new f(function(){e=b.GetEnumerator();while(g++<d&&e.MoveNext());},function(){return e.MoveNext()?this.Yield(e.Current()):a},function(){c.Dispose(e)})})},SkipWhile:function(b){b=c.CreateLambda(b);var g=this;return new e(function(){var e,i=0,h=a;return new f(function(){e=g.GetEnumerator()},function(){while(!h)if(e.MoveNext()){if(!b(e.Current(),i++)){h=d;return this.Yield(e.Current())}continue}else return a;return e.MoveNext()?this.Yield(e.Current()):a},function(){c.Dispose(e)})})},Take:function(d){var b=this;return new e(function(){var e,g=0;return new f(function(){e=b.GetEnumerator()},function(){return g++<d&&e.MoveNext()?this.Yield(e.Current()):a},function(){c.Dispose(e)})})},TakeWhile:function(b){b=c.CreateLambda(b);var d=this;return new e(function(){var e,g=0;return new f(function(){e=d.GetEnumerator()},function(){return e.MoveNext()&&b(e.Current(),g++)?this.Yield(e.Current()):a},function(){c.Dispose(e)})})},TakeExceptLast:function(d){if(d==b)d=1;var g=this;return new e(function(){if(d==0)return g.GetEnumerator();var b,e=[];return new f(function(){b=g.GetEnumerator()},function(){while(b.MoveNext()){if(e.length==d){e.push(b.Current());return this.Yield(e.shift())}e.push(b.Current())}return a},function(){c.Dispose(b)})})},IndexOf:function(c){var a=b;this.ForEach(function(e,b){if(e===c){a=b;return d}});return a!==b?a:-1},LastIndexOf:function(b){var a=-1;this.ForEach(function(d,c){if(d===b)a=c});return a},ToArray:function(){var a=[];this.ForEach(function(b){a.push(b)});return a},ToLookup:function(d,b,a){d=c.CreateLambda(d);b=c.CreateLambda(b);a=c.CreateLambda(a);var e=new m(a);this.ForEach(function(g){var f=d(g),a=b(g),c=e.Get(f);if(c!==undefined)c.push(a);else e.Add(f,[a])});return new p(e)},ToObject:function(b,a){b=c.CreateLambda(b);a=c.CreateLambda(a);var d={};this.ForEach(function(c){d[b(c)]=a(c)});return d},ToDictionary:function(d,b,a){d=c.CreateLambda(d);b=c.CreateLambda(b);a=c.CreateLambda(a);var e=new m(a);this.ForEach(function(a){e.Add(d(a),b(a))});return e},ToString:function(a,c){if(a==b)a="";if(c==b)c=g.Identity;return this.Select(c).ToArray().join(a)},Do:function(b){var d=this;b=c.CreateLambda(b);return new e(function(){var e,g=0;return new f(function(){e=d.GetEnumerator()},function(){if(e.MoveNext()){b(e.Current(),g++);return this.Yield(e.Current())}return a},function(){c.Dispose(e)})})},ForEach:function(d){d=c.CreateLambda(d);var e=0,b=this.GetEnumerator();try{while(b.MoveNext())if(d(b.Current(),e++)===a)break}finally{c.Dispose(b)}},Write:function(e,f){if(e==b)e="";f=c.CreateLambda(f);var g=d;this.ForEach(function(b){if(g)g=a;else document.write(e);document.write(f(b))})},WriteLine:function(a){a=c.CreateLambda(a);this.ForEach(function(b){document.write(a(b));document.write("<br />")})},Force:function(){var a=this.GetEnumerator();try{while(a.MoveNext());}finally{c.Dispose(a)}},Let:function(b){b=c.CreateLambda(b);var d=this;return new e(function(){var g;return new f(function(){g=e.From(b(d)).GetEnumerator()},function(){return g.MoveNext()?this.Yield(g.Current()):a},function(){c.Dispose(g)})})},Share:function(){var d=this,c;return new e(function(){return new f(function(){if(c==b)c=d.GetEnumerator()},function(){return c.MoveNext()?this.Yield(c.Current()):a},g.Blank)})},MemoizeAll:function(){var h=this,d,c;return new e(function(){var e=-1;return new f(function(){if(c==b){c=h.GetEnumerator();d=[]}},function(){e++;if(d[e]===undefined)return c.MoveNext()?this.Yield(d[e]=c.Current()):a;return this.Yield(d[e])},g.Blank)})},Catch:function(b){b=c.CreateLambda(b);var d=this;return new e(function(){var e;return new f(function(){e=d.GetEnumerator()},function(){try{return e.MoveNext()?this.Yield(e.Current()):a}catch(c){b(c);return a}},function(){c.Dispose(e)})})},Finally:function(b){b=c.CreateLambda(b);var d=this;return new e(function(){var e;return new f(function(){e=d.GetEnumerator()},function(){return e.MoveNext()?this.Yield(e.Current()):a},function(){try{c.Dispose(e)}finally{b()}})})},Trace:function(d,a){if(d==b)d="Trace";a=c.CreateLambda(a);return this.Do(function(b){console.log(d,":",a(b))})}};var g={Identity:function(a){return a},True:function(){return d},Blank:function(){}},h={Boolean:typeof d,Number:typeof 0,String:typeof "",Object:typeof {},Undefined:typeof undefined,Function:typeof function(){}},c={CreateLambda:function(a){if(a==b)return g.Identity;if(typeof a==h.String)if(a=="")return g.Identity;else if(a.indexOf("=>")==-1)return new Function("$","return "+a);else{var c=a.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return new Function(c[1],"return "+c[2])}return a},IsIEnumerable:function(b){if(typeof Enumerator!=h.Undefined)try{new Enumerator(b);return d}catch(c){}return a},Compare:function(a,b){return a===b?0:a>b?1:-1},Dispose:function(a){a!=b&&a.Dispose()}},j={Before:0,Running:1,After:2},f=function(e,f,g){var c=new o,b=j.Before;this.Current=c.Current;this.MoveNext=function(){try{switch(b){case j.Before:b=j.Running;e();case j.Running:if(f.apply(c))return d;else{this.Dispose();return a}case j.After:return a}}catch(g){this.Dispose();throw g}};this.Dispose=function(){if(b!=j.Running)return;try{g()}finally{b=j.After}}},o=function(){var a=b;this.Current=function(){return a};this.Yield=function(b){a=b;return d}},m=function(){var i=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c=function(a){if(a===b)return "null";if(a===undefined)return "undefined";return typeof a.toString===h.Function?a.toString():Object.prototype.toString.call(a)},l=function(d,c){var a=this;a.Key=d;a.Value=c;a.Prev=b;a.Next=b},j=function(){this.First=b;this.Last=b};j.prototype={AddLast:function(c){var a=this;if(a.Last!=b){a.Last.Next=c;c.Prev=a.Last;a.Last=c}else a.First=a.Last=c},Replace:function(c,a){if(c.Prev!=b){c.Prev.Next=a;a.Prev=c.Prev}else this.First=a;if(c.Next!=b){c.Next.Prev=a;a.Next=c.Next}else this.Last=a},Remove:function(a){if(a.Prev!=b)a.Prev.Next=a.Next;else this.First=a.Next;if(a.Next!=b)a.Next.Prev=a.Prev;else this.Last=a.Prev}};var k=function(c){var a=this;a.count=0;a.entryList=new j;a.buckets={};a.compareSelector=c==b?g.Identity:c};k.prototype={Add:function(h,j){var a=this,g=a.compareSelector(h),f=c(g),d=new l(h,j);if(i(a.buckets,f)){for(var b=a.buckets[f],e=0;e<b.length;e++)if(a.compareSelector(b[e].Key)===g){a.entryList.Replace(b[e],d);b[e]=d;return}b.push(d)}else a.buckets[f]=[d];a.count++;a.entryList.AddLast(d)},Get:function(h){var a=this,d=a.compareSelector(h),g=c(d);if(!i(a.buckets,g))return undefined;for(var e=a.buckets[g],b=0;b<e.length;b++){var f=e[b];if(a.compareSelector(f.Key)===d)return f.Value}return undefined},Set:function(k,m){var b=this,g=b.compareSelector(k),j=c(g);if(i(b.buckets,j))for(var f=b.buckets[j],e=0;e<f.length;e++)if(b.compareSelector(f[e].Key)===g){var h=new l(k,m);b.entryList.Replace(f[e],h);f[e]=h;return d}return a},Contains:function(j){var b=this,f=b.compareSelector(j),h=c(f);if(!i(b.buckets,h))return a;for(var g=b.buckets[h],e=0;e<g.length;e++)if(b.compareSelector(g[e].Key)===f)return d;return a},Clear:function(){this.count=0;this.buckets={};this.entryList=new j},Remove:function(g){var a=this,f=a.compareSelector(g),e=c(f);if(!i(a.buckets,e))return;for(var b=a.buckets[e],d=0;d<b.length;d++)if(a.compareSelector(b[d].Key)===f){a.entryList.Remove(b[d]);b.splice(d,1);if(b.length==0)delete a.buckets[e];a.count--;return}},Count:function(){return this.count},ToEnumerable:function(){var c=this;return new e(function(){var d;return new f(function(){d=c.entryList.First},function(){if(d!=b){var c={Key:d.Key,Value:d.Value};d=d.Next;return this.Yield(c)}return a},g.Blank)})}};return k}(),p=function(a){var b=this;b.Count=function(){return a.Count()};b.Get=function(b){return e.From(a.Get(b))};b.Contains=function(b){return a.Contains(b)};b.ToEnumerable=function(){return a.ToEnumerable().Select(function(a){return new n(a.Key,a.Value)})}},n=function(c,b){this.Key=function(){return c};this.GetEnumerator=function(){var c=-1;return new f(g.Blank,function(){return ++c<b.length?this.Yield(b[c]):a},g.Blank)}};n.prototype=new e;var i=function(f,b,d,e){var a=this;a.source=f;a.keySelector=c.CreateLambda(b);a.descending=d;a.parent=e};i.prototype=new e;i.prototype.CreateOrderedEnumerable=function(a,b){return new i(this.source,a,b,this)};i.prototype.ThenBy=function(b){return this.CreateOrderedEnumerable(b,a)};i.prototype.ThenByDescending=function(a){return this.CreateOrderedEnumerable(a,d)};i.prototype.GetEnumerator=function(){var i=this,d,c,h=0;return new f(function(){d=i.source.ToArray();c=e.Range(0,d.length).ToArray();sortContext=k.Create(i,b);sortContext.GenerateKeys(d);c.sort(function(a,b){return sortContext.Compare(a,b)})},function(){return h<c.length?this.Yield(d[c[h++]]):a},g.Blank)};var k=function(c,d,e){var a=this;a.keySelector=c;a.descending=d;a.child=e;a.keys=b};k.Create=function(a,d){var c=new k(a.keySelector,a.descending,d);if(a.parent!=b)return k.Create(a.parent,c);return c};k.prototype.GenerateKeys=function(c){var a=this;a.keys=e.From(c).Select(a.keySelector).ToArray();a.child!=b&&a.child.GenerateKeys(c)};k.prototype.Compare=function(e,f){var a=this,d=c.Compare(a.keys[e],a.keys[f]);if(d==0){if(a.child!=b)return a.child.Compare(e,f);d=c.Compare(e,f)}return a.descending?-d:d};return e}()});(function(a){a.fn.toEnumerable=function(){return a.Enumerable.From(this).Select(function(b){return a(b)})};a.Enumerable.prototype.TojQuery=function(){return a(this.ToArray())}})(jQuery)